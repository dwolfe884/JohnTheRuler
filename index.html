<!DOCTYPE html>
<html lang='en'>
<head>
<link rel="stylesheet" href="main.css">
</head>
<div class="center-screen">
    <div class="inline-div">
    <h2>Input</h2>
    <textarea id="input" name="input" rows="20" cols="10" class="inline-txtarea">123456
12345
123456789
password
iloveyou
princess
1234567
rockyou
12345678
abc123
nicole
daniel
babygirl
monkey
lovely
jessica</textarea>
    </div>
    <div class="inline-div">
    <h2>JTR Rule</h2>
    <textarea id="rule" name="rule" rows="10" cols="10" class="inline-txtarea">[List.Rules:jtestcom]
u
cAz"[0-9][0-9]"</textarea>
    </div>
    <div class="inline-div">
    <h2>Output</h2>
    <textarea id="output" name="output" rows="20" cols="10" class="inline-txtarea"></textarea>
    </div>
</div>
<div class="center-screen"><h2>Rule List</h2></div>
<div class="rule-container">
    <ul class="rule-info">
        <li>l = convert to lowercase</li>
        <li>u = convert to uppercase</li>
        <li>c = capitalize</li>
        <li>C = lowercase the first character, and uppercase the rest</li>
        <li>t = toggle case of all characters</li>
        <li>TN = toggle case of the Nth character</li>
        <li>AN"STR" = insert at location N in the word (0 = start, z = end of string)</li>
        <li>[ = remove first character</li>
        <li>] = remove last character</li>
        <li>r = reverse</li>
        <li>f = reflect (passworddorwssap)</li>
    </ul>
</div>
</html>
<script>
    var inlist = document.getElementById('input').value;
    //console.log(inlist)
    

const selectElement = document.getElementById('input');

selectElement.addEventListener('change', (event) => {
  //console.log("Changed")
  updateRule()
  selectElement.value = selectElement.value.split(' ').join('\n');
});

const ruleElement = document.getElementById('rule');

ruleElement.addEventListener('change', (event) => {
  updateRule();
});
window.onload = updateRule();

function recurse(arr,inside){
    var done = false;
    //inside = "[9-0][0-9]"
    //each call strip off one of the [] pairs
    var tmp = [];
    if(inside == ""){
        return arr;
    }
    if(inside.indexOf("[") == -1){
        console.log("In missing [ loop");
        for(var i=0; i<arr.length; i++){
            tmp.push(arr[i] + inside);
        }
        splits = [];
        done = true;
        //recurse(tmp,"");
    }
    if(!done){
        var splits = inside.split(/[\[\]]+/);
        var first = true;
        var location = 0;
        var indiv = splits[1];
        var start = indiv.charCodeAt(0);
        var end = indiv.charCodeAt(2);
        if(arr.length == 0){
            if(start < end){
                while(start <= end){
                    tmp.push(splits[0] + String.fromCharCode(start));
                    start+=1;
                }           
            }
            else{
                while(start >= end){
                    tmp.push(splits[0] + String.fromCharCode(start));
                    start-=1;
                }
            }
            splits.splice(0,2);
            //recurse(tmp,splits.join(""));
        }
        else{
            for(var i=0; i<arr.length; i++){
                start = indiv.charCodeAt(0);
                end = indiv.charCodeAt(2);
                if(start < end){
                    while(start <= end){
                        tmp.push(arr[i] + String.fromCharCode(start));
                        start+=1;
                    }           
                }
                else{
                    while(start >= end){
                        tmp.push(arr[i] + String.fromCharCode(start));
                        start-=1;
                    }
                }
                
                splits.splice(0,1);
                //recurse(tmp,splits.join(""));
            }
        }
    }
    console.log("original: ");
    console.log(inside);
    console.log("curr arr:");
    console.log(tmp);
    console.log("still to process:");
    console.log(inside.substring(inside.indexOf("]")+1,inside.length));
    if(done){
        return recurse(tmp, "");
    }
    else{
        return recurse(tmp, inside.substring(inside.indexOf("]")+1,inside.length));
    }
}

function parseRule(word,rule){
    var found = false;
    var skip = false;
    var finishedWords = [];
    if(rule == ""){
        return [word];
    }
    while(rule != ""){
        var parsingQ = true;
        while(parsingQ){ 
            var tmp = rule.indexOf("?");
            //If there is a ? in the rule
            if(tmp != -1){
                //TODO: Do work on ? cases
                rule = rule.substring(0,tmp-1) + rule.substring(tmp+1,rule.length);
                //console.log(rule)
            }
            else{
                parsingQ = false;
            }
        }
        //Done Parsing ?'s
        //Check for u = convert to uppercase
        if(rule.indexOf("u") == 0){
            word = word.toUpperCase();
            rule = rule.substring(1);
            found = true;
        }
        //Check for [ = delete first char
        if(rule.indexOf("[") == 0){
            word = word.slice(1);
            rule = rule.substring(1);
            found = true;
        }
        if(rule.indexOf("]") == 0){
            word = word.slice(0, word.length-1);
            rule = rule.substring(1);
            found = true;
        }
        //Check for l = convert to lowercase
        if(rule.indexOf("l") == 0){
            word = word.toLowerCase();
            rule = rule.substring(1);
            found = true;
        }
        //Check for r = reverse
        if(rule.indexOf("r") == 0){
            var tmp = word.split("");
            tmp = tmp.reverse();
            word = tmp.join("");
            rule = rule.substring(1);
            found = true;
        }
        //Check for f = reflect
        if(rule.indexOf("f") == 0){
            var tmp = word.split("");
            tmp = tmp.reverse();
            word = word + tmp.join("");
            rule = rule.substring(1);
            found = true;
        }
        //Check for c = capitalize first letter
        if(rule.indexOf("c") == 0){
            word = word.charAt(0).toUpperCase() + word.slice(1);
            rule = rule.substring(1);
            found = true;
        }
        //Check for C = capitalize everything except first letter
        if(rule.indexOf("C") == 0){
            word = word.charAt(0).toLowerCase() + word.slice(1).toUpperCase();
            rule = rule.substring(1);
            found = true;
        }
        //Check for t = toggle all cases
        if(rule.indexOf("t") == 0){
            var newWord = "";
            for(var k=0; k<word.length; k++){
                letter = word[k];
                if(letter == letter.toLowerCase()){
                    newWord += letter.toUpperCase();
                }
                else if(letter == letter.toUpperCase()){
                    newWord += letter.toLowerCase();
                }
                else{
                    newWord += letter;
                }
            }
            word = newWord;
            console.log(word)
            rule = rule.substring(1);
            found = true;
        }
        //Check for A = Append at specific 
        if(rule.indexOf("A") == 0){
            var tmp = rule.indexOf("A");
            var where = rule.charAt(tmp+1);
            //Prepend
            if(where == "z"){
                where = word.length;
            }
            if(isNaN(parseInt(where))){
                    output.value += "Error after 'A'\n";
                    rule = "";
                    failed = true;
            }
            else{
                if(rule.charAt(tmp+2) != "\"" && rule.charAt(tmp+2) != "\'"){
                    failed = true;
                    rule = "";
                    reason = "Missing quotes after append";
                }
                else{
                    var toAdd = rule.substring(tmp+2).split(/[\"\']+/)[1]
                    if(toAdd.indexOf("[") != -1 && toAdd.indexOf("]") != -1){
                        var allCombos = recurse([],toAdd);
                        console.log("Final array:")
                        console.log(allCombos);
                        var splits = toAdd.split("]");
                        for(var i=0; i<allCombos.length; i++){
                            var nextrule = rule.substring(3);
                            nextrule = nextrule.substring(nextrule.indexOf("\"")+1);
                            var output = parseRule((word.slice(0,parseInt(where))+allCombos[i] + word.slice(parseInt(where))),nextrule);
                            for(var o=0; o<output.length; o++){
                                finishedWords.push(output[o]);
                            }
                            //wordValue.push(word.slice(0,parseInt(where))+allCombos[i] + word.slice(parseInt(where))+"\n");
                            //output.value += word.slice(0,parseInt(where))+allCombos[i] + word.slice(parseInt(where))+"\n";
                            skip = true;
                            //word = word.slice(0,parseInt(where))+allCombos[i] + word.slice(parseInt(where))+"\n";
                        }
                    }
                    else{
                        word = word.slice(0,parseInt(where))+rule.substring(tmp+2).split("\"")[1] + word.slice(parseInt(where))+"\n"
                    }
                }
            }
            rule = rule.substring(3);
            rule = rule.substring(rule.indexOf("\"")+1);
            if(skip){
                rule = "";
            }
            console.log("checking rule:")
            console.log(rule)
            found = true;
        }
        if(!found){
            finishedWords.push("Error on character: " + rule.charAt(0));
            return finishedWords;
        }
    }
    if(!skip){
        finishedWords.push(word);
    }
    return finishedWords;
}

function updateRule(){
    const output = document.getElementById("output")
    output.value = ""
    const ruleValue = document.getElementById('rule').value.split("\n");
    for(var i=1; i<ruleValue.length; i++){
        var rule = ruleValue[i]
        output.value += ("-----"+rule+"-----\n");
        const wordValue = document.getElementById('input').value.split("\n");
        for(var j=0; j<wordValue.length; j++){
            var donewords = parseRule(wordValue[j],rule);
            for(var o=0; o<donewords.length; o++){
                output.value += donewords[o]+"\n";
            }
        }/*
            var tmpRule = rule;
            var failed = false;
            var reason = "";
            var word = wordValue[j];
            var skip = false;
            if(word != ""){
                var processingPipeline = [word];
                while(tmpRule != ""){
                    var parsingQ = true;
                    while(parsingQ){ 
                        var tmp = rule.indexOf("?");
                        //If there is a ? in the rule
                        if(tmp != -1){
                            //TODO: Do work on ? cases
                            rule = rule.substring(0,tmp-1) + rule.substring(tmp+1,rule.length);
                            //console.log(rule)
                        }
                        else{
                            parsingQ = false;
                        }
                    }
                    //Done Parsing ?'s
                    //Check for u = convert to uppercase
                    if(tmpRule.indexOf("u") == 0){
                        word = word.toUpperCase();
                        tmpRule = tmpRule.substring(1);
                    }
                    //Check for l = convert to lowercase
                    if(tmpRule.indexOf("l") == 0){
                        word = word.toLowerCase();
                        tmpRule = tmpRule.substring(1);
                    }
                    //Check for c = capitalize first letter
                    if(tmpRule.indexOf("c") == 0){
                        word = word.charAt(0).toUpperCase() + word.slice(1);
                        tmpRule = tmpRule.substring(1);
                    }
                    //Check for C = capitalize everything except first letter
                    if(tmpRule.indexOf("C") == 0){
                        word = word.charAt(0).toLowerCase() + word.slice(1).toUpperCase();
                        tmpRule = tmpRule.substring(1);
                    }
                    //Check for t = toggle all cases
                    if(tmpRule.indexOf("t") == 0){
                        var newWord = "";
                        for(var k=0; k<word.length; k++){
                            letter = word[k];
                            if(letter == letter.toLowerCase()){
                                newWord += letter.toUpperCase();
                            }
                            else if(letter == letter.toUpperCase()){
                                newWord += letter.toLowerCase();
                            }
                            else{
                                newWord += letter;
                            }
                        }
                        word = newWord;
                        console.log(word)
                        tmpRule = tmpRule.substring(1);
                    }
                    //Check for A = Append at specific 
                    if(tmpRule.indexOf("A") == 0){
                        var tmp = rule.indexOf("A");
                        var where = rule.charAt(tmp+1);
                        //Prepend
                        if(where == "z"){
                            where = word.length;
                        }
                        if(isNaN(parseInt(where))){
                                output.value += "Error after 'A'\n";
                                tmpRule = "";
                                failed = true;
                        }
                        else{
                            if(rule.charAt(tmp+2) != "\"" && rule.charAt(tmp+2) != "\'"){
                                failed = true;
                                tmpRule = "";
                                reason = "Missing quotes after append";
                            }
                            else{
                                var toAdd = rule.substring(tmp+2).split(/[\"\']+/)[1]
                                if(toAdd.indexOf("[") != -1 && toAdd.indexOf("]") != -1){
                                    var allCombos = recurse([],toAdd);
                                    console.log("Final array:")
                                    console.log(allCombos);
                                    var splits = toAdd.split("]");
                                    for(var i=0; i<allCombos.length; i++){
                                        //wordValue.push(word.slice(0,parseInt(where))+allCombos[i] + word.slice(parseInt(where))+"\n");
                                        output.value += word.slice(0,parseInt(where))+allCombos[i] + word.slice(parseInt(where))+"\n";
                                        skip = true;
                                    }
                                }
                                else{
                                    word = word.slice(0,parseInt(where))+rule.substring(tmp+2).split("\"")[1] + word.slice(parseInt(where))+"\n"
                                }
                            }
                        }
                        tmpRule = tmpRule.substring(3);
                        tmpRule = tmpRule.substring(tmpRule.indexOf("\"")+1);
                    }
                }
                //console.log(word);
                if(!failed && !skip){
                    output.value += word+"\n";
                }
                else if(failed){
                    output.value += reason+"\n";
                }
                else if(skip){
                    output.value += "\n";
                }
            }
        }*/
    }
}

</script>